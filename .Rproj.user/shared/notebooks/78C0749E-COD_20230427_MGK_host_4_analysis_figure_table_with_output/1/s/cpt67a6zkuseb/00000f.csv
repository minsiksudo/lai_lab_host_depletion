"0",""
"0","#Making significance table for figure"
"0","        # Define a function to make species names italicized"
"0","# Make a significance table for each figure (top 20 taxa)"
"0","species_italic <- function(data) {"
"0","  names <- gsub(""_"", "" "", rownames(data))"
"0","  names <- gsub(""[]]|[[]"", """", names)"
"0","  names <- gsub("" sp"", "" sp."", names)"
"0","  names <- gsub("" sp."", ""* sp."", names)"
"0","  names <- gsub("" group"", """", names)"
"0","  names <- ifelse(grepl(""[*]"", names), paste(""*"", names, sep = """"), paste(""*"", names, ""*"", sep = """"))"
"0","  rownames(data) <- names"
"0","  data"
"0","}"
"0","species_revise <- function(data) {"
"0","  data$feature <- gsub(""Saccharomyces_cerevisiae_x_Saccharomyces_kudriavzevii"", ""S._cerevisiae x S._kudriavzevii"", data$feature)"
"0","  data$feature <- gsub(""Pseudomonas_aeruginosa_group"", ""Pseudomonas_aeruginosa"", data$feature)"
"0","  data$feature <- gsub(""Pseudomonas_fluorescens_group"", ""Pseudomonas_fluorescens"", data$feature)"
"0","  data"
"0","}"
"0",""
"0",""
"0",""
"0","make_sig_table <- function(data) {"
"0","  sig_data <- spread(data[order(data$qval), c(""feature"", ""metadata"", ""qval"")], metadata, qval)"
"0","  sig_data <- species_revise(sig_data)"
"0","  sig_data$min <- apply(sig_data %>% dplyr::select(c(""lypma"", ""benzonase"", ""molysis"", ""host_zero"", ""qiaamp"")), 1, FUN = min)"
"0","  sig_data <- sig_data[order(sig_data$min),] %>% dplyr::select(""feature"", ""lypma"", ""benzonase"", ""host_zero"", ""molysis"", ""qiaamp"") %>% .[1:20,]"
"0","  sig_data[[""feature""]] <- ifelse(sig_data[[""feature""]] == ""X.Collinsella._massiliensis"", ""[Collinsella]_massiliensis"", sig_data[[""feature""]])"
"0","  sig_data_italic <- sig_data %>% rownames_to_column(var = ""-"") %>%"
"0","          column_to_rownames(var = ""feature"") %>% species_italic %>% dplyr::select(-c(""-"")) %>%"
"0","          rename(lyPMA = lypma,  Benzonase = benzonase, `HostZERO` = host_zero, MolYsis = molysis, QIAamp = qiaamp)"
"0","  sig_data_sig <- ifelse(sig_data_italic < 0.1, ""*"", NA) %>% data.frame(check.names = F)"
"0","  return(list(data = sig_data, data_italic = sig_data_italic, data_sig = sig_data_sig))"
"0","}"
"0",""
"0",""
"0",""
"0","#filt_fit_data_pos <- make_sig_table(filt_fit_data_pos)"
"0","filt_fit_data_bal <- make_sig_table(filt_fit_data_bal)"
"0","filt_fit_data_ns <- make_sig_table(filt_fit_data_ns)"
"0","filt_fit_data_spt <- make_sig_table(filt_fit_data_spt)"
"0",""
"0","#filt_pos_sig <- subset_taxa(subset_samples(phyloseq_unfiltered$phyloseq_rel, sample_type == ""Mock""),"
"0","#                                       taxa_names(subset_samples(phyloseq_unfiltered$phyloseq_rel, sample_type == ""Mock"")) %in% filt_fit_data_pos$data$feature)"
"0",""
"0","#filt_fit_data_pos$rel <- cbind(filt_pos_sig %>% otu_table %>% t, filt_pos_sig %>% sample_data) %>% group_by(treatment) %>% summarise_if(is.numeric, mean, na.rm = TRUE) %>% .[, 1:21] %>% column_to_rownames(., ""treatment"") %>% t () %>% species_italic() %>%  data.frame(check.names = F) %>% "
"0","#        .[row.names(filt_fit_data_pos$data_italic),] %>%  mutate_all(~na_if(., 0)) %>% rownames_to_column(""feature"")"
"0",""
"0","filt_spt_sig <- subset_taxa(subset_samples(phyloseq_unfiltered$phyloseq_rel, sample_type == ""Sputum""), taxa_names(subset_samples(phyloseq_unfiltered$phyloseq_rel, sample_type == ""Sputum"")) %in% filt_fit_data_spt$data$feature)"
"0",""
"0","filt_fit_data_spt$rel <- cbind(filt_spt_sig %>% otu_table %>% t, filt_spt_sig %>% sample_data) %>% group_by(treatment) %>% summarise_if(is.numeric, mean, na.rm = TRUE) %>% .[, 1:21] %>% column_to_rownames(., ""treatment"") %>% t () %>% species_italic() %>%  data.frame(check.names = F) %>% "
"0","        .[row.names(filt_fit_data_spt$data_italic),] %>%  mutate_all(~na_if(., 0)) %>% rownames_to_column(""feature"")"
"0",""
"0","filt_ns_sig <- subset_taxa(subset_samples(phyloseq_unfiltered$phyloseq_rel, sample_type == ""Nasal""),"
"0","                                       taxa_names(subset_samples(phyloseq_unfiltered$phyloseq_rel, sample_type == ""Nasal"")) %in% filt_fit_data_ns$data$feature)"
"0",""
"0","filt_fit_data_ns$rel <- cbind(filt_ns_sig %>% otu_table %>% t, filt_ns_sig %>% sample_data) %>% group_by(treatment) %>% summarise_if(is.numeric, mean, na.rm = TRUE) %>% .[, 1:21] %>% column_to_rownames(., ""treatment"") %>% t () %>% species_italic() %>%  data.frame(check.names = F) %>% "
"0","        .[row.names(filt_fit_data_ns$data_italic),] %>%  mutate_all(~na_if(., 0)) %>% rownames_to_column(""feature"")"
"0",""
"0","filt_bal_sig <- subset_taxa(subset_samples(phyloseq_unfiltered$phyloseq_rel, sample_type == ""BAL""),"
"0","                                       taxa_names(subset_samples(phyloseq_unfiltered$phyloseq_rel, sample_type == ""BAL"")) %in% filt_fit_data_bal$data$feature)"
"0",""
"0","filt_fit_data_bal$rel <- cbind(filt_bal_sig %>% otu_table %>% t, filt_bal_sig %>% sample_data) %>% group_by(treatment) %>% summarise_if(is.numeric, mean, na.rm = TRUE) %>% .[, 1:21] %>% column_to_rownames(., ""treatment"") %>% t () %>% species_italic() %>%  data.frame(check.names = F) %>%"
"0","        .[row.names(filt_fit_data_bal$data_italic),] %>%"
"0","        mutate_all(~na_if(., 0)) %>% rownames_to_column(""feature"") %>% subset(., !grepl(""NA"", .$feature))"
"0",""
"0",""
