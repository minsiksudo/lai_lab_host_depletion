"0","geometric_mean <- function(x, replace_zeros = ""minimum"") {"
"0","                "
"0","                # pseudocounts"
"0","                if (replace_zeros == ""minimum"") {"
"0","                        x[x == 0] <- min(x[x > 0]) # cheap pseudocount - take minimum"
"0","                } else if (replace_zeros == ""half"") {"
"0","                        x[x == 0] <- min(x[x > 0])/2 # cheap pseudocount - take half minimum"
"0","                } else if (is.numeric(replace_zeros)) {"
"0","                        if (replace_zeros <= 0) stop(""You've told me to replace zeroes with zero, or a nonnegative value!"")"
"0","                        x[x == 0] <- replace_zeros "
"0","                }"
"0","                if (any(x == 0)) stop(""There are zeros in x and you haven't told me what to do with them!"")"
"0","                "
"0","                stopifnot(all(x >= 0))"
"0","                "
"0","                ## convert to relative abundance:"
"0","                pz <- x/sum(x)"
"0","                "
"0","                prod(pz)^(1/length(pz))"
"0","                "
"0","        }"
"0","        "
"0","        clr <- function(x, replace_zeros = ""minimum"") {"
"0","                "
"0","                stopifnot(all(x >= 0))"
"0","                "
"0","                # pseudocounts"
"0","                if (replace_zeros == ""minimum"") {"
"0","                        x[x == 0] <- min(x[x > 0]) # cheap pseudocount - take minimum"
"0","                } else if (replace_zeros == ""half"") {"
"0","                        x[x == 0] <- min(x[x > 0])/2 # cheap pseudocount - take half minimum"
"0","                } else if (is.numeric(replace_zeros)) {"
"0","                        if (replace_zeros <= 0) stop(""You've told me to replace zeroes with zero, or a nonnegative value!"")"
"0","                        x[x == 0] <- replace_zeros "
"0","                }"
"0","                if (any(x == 0)) stop(""There are zeros in x and you haven't told me what to do with them!"")"
"0","                "
"0","                ## convert to relative abundance:"
"0","                pz <- x/sum(x)"
"0","                "
"0","                gz <- prod(pz)^(1/length(pz))"
"0","                "
"0","                log(pz/gz)"
"0","                "
"0","        }"
"0","        "
"0","        ### examples"
"0","        #clr(c(1))"
"0","clr(c(0.2, 0.1, 0.7, 0), replace_zeros=0.05) "
"1","[1]"
"1","  0.2066696"
"1"," -0.4864775"
"1","  1.4594326"
"1"," -1.1796247"
"1","
"
