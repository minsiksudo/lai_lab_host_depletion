"0",""
"0","phyloseq_unfiltered$phyloseq_rel <- transform_sample_counts(phyloseq_unfiltered$phyloseq_rel,"
"0","                                                            function(x){x/sum(x)})"
"0","taxa_qc <- data.frame(""species"" ="
"0","                              otu_table("
"0","                                      subset_samples("
"0","                                              phyloseq_unfiltered$phyloseq_rel,S.obs != 0 &"
"0","                                                      sample_type %in% c(""Mock"", ""BAL"", ""Nasal"", ""Sputum""))) %>%"
"0","                              t() %>% colnames(),"
"0","                      ""prevalence"" ="
"0","                              ifelse(subset_samples(phyloseq_unfiltered$phyloseq_rel, S.obs != 0 & "
"0","                                                            sample_type %in% c(""Mock"", ""BAL"", ""Nasal"", ""Sputum"")) %>%"
"0","                                             otu_table() > 0, 1, 0)%>% "
"0","                              t() %>%"
"0","                              colSums(), #Prevalence of taxa"
"0","                      ""mean_rel_abd"" = "
"0","                              subset_samples(phyloseq_unfiltered$phyloseq_rel,"
"0","                                             S.obs != 0 & sample_type %in% c(""Mock"", ""BAL"", ""Nasal"", ""Sputum"")) %>%"
"0","                              otu_table() %>%"
"0","                              t() %>%"
"0","                              colMeans(na.rm = T) #mean relativ abundacne "
"0",")"
"0",""
"0",""
"0","function_qc <- data.frame(""function"" ="
"0","                                  otu_table("
"0","                                          subset_samples("
"0","                                                  phyloseq_unfiltered$phyloseq_path_rpk,"
"0","                                                           S.obs != 0 & "
"0","                                                          sample_type %in% "
"0","                                                          c(""Mock"", ""BAL"", ""Nasal"", ""Sputum"")"
"0","                                                  )"
"0","                                          ) %>% "
"0","                                  t() %>% "
"0","                                  colnames(),"
"0","                          ""prevalence"" = "
"0","                                  ifelse(subset_samples(phyloseq_unfiltered$phyloseq_path_rpk,"
"0","                                                        S.obs != 0 & "
"0","                                                                sample_type %in% "
"0","                                                                c(""Mock"", ""BAL"", ""Nasal"", ""Sputum"")"
"0","                                                        ) %>% "
"0","                                                 otu_table() > 0, "
"0","                                         1, "
"0","                                         0"
"0","                                         ) %>% "
"0","                                  t() %>% "
"0","                                  colSums(), #Prevalence of taxa"
"0","                          ""mean_rpk"" = "
"0","                                  subset_samples(phyloseq_unfiltered$phyloseq_path_rpk, "
"0","                                                 S.obs != 0 & "
"0","                                                         sample_type %in% "
"0","                                                         c(""Mock"", ""BAL"", ""Nasal"", ""Sputum"")"
"0","                                                 ) %>% "
"0","                                  otu_table() %>% "
"0","                                  t() %>% "
"0","                                  colMeans(na.rm = T), #mean relativ abundacne "
"0","                          unidentified = "
"0","                                  ifelse((subset_samples(phyloseq_unfiltered$phyloseq_path_rpk,"
"0","                                              S.obs != 0 & sample_type %in% c(""Mock"", ""BAL"", ""Nasal"", ""Sputum"")) %>% "
"0","                                       otu_table() > 0) %>%"
"0","                                      row.names() %in% c(""UNMAPPED"", ""UNINTEGRATED"")"
"0","                              , 1, 0)"
"0",")"
"0",""
"0","red_flag_taxa <- data.frame(species = taxa_qc$species,"
"0","                            prevalence = taxa_qc$prevalence,"
"0","                            mean_rel_abd = taxa_qc$mean_rel_abd,"
"0","                            red_flag_prev_abd = "
"0","                                    ifelse(taxa_qc$prevalence < "
"0","                                                   otu_table("
"0","                                                           subset_samples("
"0","                                                                   phyloseq_unfiltered$phyloseq_rel,"
"0","                                                                   S.obs != 0 & "
"0","                                                                           sample_type %in% "
"0","                                                                           c(""Mock"", ""BAL"", ""Nasal"", ""Sputum""))) %>%"
"0","                                                               t %>% rownames() %>%"
"0","                                                   length * 0.05 &"
"0","                                                   #Removing taxa with zero prevalence - taxa from nasal swabs"
"0","                                                   taxa_qc$mean_rel_abd <"
"0","                                                   taxa_qc %>%"
"0","                                                   subset(., .$prevalence != 0) %>%"
"0","                                                   .$mean_rel_abd %>%"
"0","                                                   quantile(., 0.75), 1,0),"
"0","                           red_flag_prev ="
"0","                                    ifelse(taxa_qc$prevalence < "
"0","                                                   otu_table("
"0","                                                           subset_samples("
"0","                                                                   phyloseq_unfiltered$phyloseq_rel,"
"0","                                                                   S.obs != 0 & "
"0","                                                                           sample_type %in% "
"0","                                                                           c(""Mock"", ""BAL"", ""Nasal"", ""Sputum""))) %>%"
"0","                                                               t %>% rownames() %>%"
"0","                                                   length * 0.05,"
"0","                                           1,"
"0","                                           0)) %>%"
"0","        mutate(red_flag_decontam = species %in% (contaminants$Taxa %>% unique()))"
"0",""
"0","subset(red_flag_taxa, red_flag_taxa$red_flag_prev == 1 & red_flag_taxa$red_flag_prev_abd == 0)"
