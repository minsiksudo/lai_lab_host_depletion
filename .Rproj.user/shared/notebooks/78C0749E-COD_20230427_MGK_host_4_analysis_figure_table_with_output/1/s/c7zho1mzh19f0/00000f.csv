"0",""
"0",""
"0","f4a <- ggplot(subset(sample_data(phyloseq$phyloseq_path_rpk) %>% "
"0","                             data.frame,"
"0","                     sample_data(phyloseq$phyloseq_path_rpk)$sample_type %in% "
"0","                             c(""Sputum"",""Nasal"", ""BAL""#, ""Mock"""
"0","                               )), aes(x = treatment, y = S.obs)) +"
"0","        geom_jitter(aes(color = treatment), position = position_jitter(0.2), size = 1.2,"
"0","                    alpha = 0.3, stroke = 0) +"
"0","        stat_summary(aes(color = treatment),"
"0","                             fun.data=""mean_sdl"",  fun.args = list(mult=1), "
"0","                             geom = ""pointrange"",  size = 0.4) +"
"0","        ylab(""Function richness"") +"
"0","        xlab(""Treatment group"") +"
"0","        theme_classic (base_size = 12, base_family = ""sans"") + "
"0","        scale_color_manual(values = c(""#e31a1c"", ""#fb9a99"", ""#33a02c"", ""#b2df8a"", ""#1f78b4"", ""#a6cee3""), name = ""Treatment"", labels = c(""Untreated"",""lyPMA"", ""Benzonase"", ""HostZERO"", ""MolYsis"", ""QIAamp"")) + #color using "
"0","        labs(tag = ""A"") +"
"0","        theme(plot.tag = element_text(size = 15),  axis.text.x = element_blank(), axis.ticks.x = element_blank()) +"
"0","        facet_wrap(~sample_type, nrow = 1) + "
"0","        guides(col = guide_legend(nrow = 1)) "
"0",""
"0","dat_text <- data.frame("
"0","  label = c("
"0","          #""**"", ""***"", ""***"", """", ""***"", #label for Mock"
"0","          """", ""**"", ""***"", ""***"", ""**"", #label for BAL"
"0","          """", """", ""***"", ""**"", ""***"", "
"0","          ""**"", ""***"", ""***"", ""***"", ""***""),"
"0","  sample_type = c("
"0","          #""Mock"", ""Mock"", ""Mock"", ""Mock"", ""Mock"", "
"0","          ""BAL"", ""BAL"", ""BAL"", ""BAL"", ""BAL"", "
"0","          ""Nasal"", ""Nasal"", ""Nasal"", ""Nasal"", ""Nasal"", "
"0","          ""Sputum"", ""Sputum"", ""Sputum"", ""Sputum"", ""Sputum""),"
"0","  treatment     = c("
"0","          #""lyPMA"", ""Benzonase"", ""HostZERO"", ""MolYsis"", ""QIAamp"", "
"0","          ""lyPMA"", ""Benzonase"", ""HostZERO"", ""MolYsis"", ""QIAamp"","
"0","          ""lyPMA"", ""Benzonase"", ""HostZERO"", ""MolYsis"", ""QIAamp"","
"0","          ""lyPMA"", ""Benzonase"", ""HostZERO"", ""MolYsis"", ""QIAamp""),"
"0","  S.obs = c("
"0","          #420, 400, 330, 410, 400,"
"0","          250, 230, 300, 320, 300,"
"0","          210, 220, 230, 240, 250,"
"0","          330, 350, 370, 350, 360)"
"0",")"
"0",""
"0","dat_text$sample_type <- factor(dat_text$sample_type, levels = c(#""Mock"", "
"0","                                                                ""BAL"", ""Nasal"", ""Sputum""))"
"0","dat_text$treatment <- factor(dat_text$treatment, levels = c(""Untreated"", ""lyPMA"", ""Benzonase"", ""HostZERO"", ""MolYsis"", ""QIAamp""))"
"0",""
"0",""
"0",""
"0","f4a <- f4a + geom_text("
"0","  data    = dat_text,"
"0","  mapping = aes(x = treatment, y = S.obs, label = label)"
"0",")"
"0",""
"0",""
"0","#f3a <- f3a + geom_text("
"0","#  data    = dat_text,"
"0","#  mapping = aes(x = treatment, y = S.obs, label = label)"
"0","#)"
"0",""
"0",""
"0","#distances of betadiversity - boxplots"
"0","horn_dist_long <- distance(phyloseq_rel_nz, method=""horn"") %>% as.matrix() %>% melt_dist() #making long data of distance matrices"
"0",""
"0","#Adding sample type and treatment name. "
"0","#this can be also done by merging metadata into the `horn_dist_long`"
"0","names <- data.frame(str_split_fixed(horn_dist_long$iso1, ""_"", 3))"
"0","names2 <- data.frame(str_split_fixed(horn_dist_long$iso2, ""_"", 3))"
"0","horn_dist_long$sample_id_1 <- paste(names$X1, names$X2, sep = ""_"")"
"0","horn_dist_long$method_1 <- ifelse(grepl(""lyPMA"", horn_dist_long$iso1),""lypma"", "
"0","                                         ifelse(grepl(""ben"", horn_dist_long$iso1),""benzonase"", "
"0","                                                ifelse(grepl(""host"", horn_dist_long$iso1),""host_zero"", "
"0","                                                       ifelse(grepl(""qia"", horn_dist_long$iso1),""qiaamp"", "
"0","                                                              ifelse(grepl(""moly"", horn_dist_long$iso1),""molysis"", "
"0","                                                                     ""control"")))))"
"0",""
"0",""
"0","#Adding data for iso 2 also should be done"
"0","horn_dist_long$sample_id_2 <- paste(names2$X1, names2$X2, sep = ""_"")"
"0","horn_dist_long$method_2 <-ifelse(grepl(""lyPMA"", horn_dist_long$iso2),""lypma"", "
"0","                                        ifelse(grepl(""ben"", horn_dist_long$iso2),""benzonase"", "
"0","                                               ifelse(grepl(""host"", horn_dist_long$iso2),""host_zero"", "
"0","                                                      ifelse(grepl(""qia"", horn_dist_long$iso2),""qiaamp"", "
"0","                                                             ifelse(grepl(""moly"", horn_dist_long$iso2),""molysis"", "
"0","                                                                    ""control"")))))"
"0",""
"0",""
"0","#subsetting distances of my interest"
"0","horn_dist_long$sample_id_1 <- ifelse(grepl(""pos"", horn_dist_long$sample_id_1, ignore.case = T),""Mock"", "
"0","                                 ifelse(grepl(""neg|n_"", horn_dist_long$sample_id_1, ignore.case = T),""Neg."","
"0","                                        horn_dist_long$sample_id_1))"
"0","horn_dist_long$sample_id_2 <- ifelse(grepl(""pos"", horn_dist_long$sample_id_2, ignore.case = T),""Mock"", "
"0","                                 ifelse(grepl(""neg|n_"", horn_dist_long$sample_id_2, ignore.case = T),""Neg."","
"0","                                        horn_dist_long$sample_id_2))"
"0",""
"0",""
"0","path_horn_dist_long_within_sampleid_from_control <- subset(horn_dist_long, horn_dist_long$sample_id_1 == horn_dist_long$sample_id_2) # data within samples"
"0",""
"0","path_horn_dist_long_within_sampleid_from_control <- subset(path_horn_dist_long_within_sampleid_from_control,"
"0","                                                           path_horn_dist_long_within_sampleid_from_control$method_1 != path_horn_dist_long_within_sampleid_from_control$method_2) # remove irrelevant association"
"0",""
"0","path_horn_dist_long_within_sampleid_from_control <- subset(path_horn_dist_long_within_sampleid_from_control, (path_horn_dist_long_within_sampleid_from_control$method_1 == ""control"") + (path_horn_dist_long_within_sampleid_from_control$method_2 == ""control"") != 0)"
"0",""
"0",""
"0","path_horn_dist_long_within_sampleid_from_control$treatment <- path_horn_dist_long_within_sampleid_from_control$method_1"
"0",""
"0","path_horn_dist_long_within_sampleid_from_control$treatment <- ifelse(path_horn_dist_long_within_sampleid_from_control$treatment == ""control"", path_horn_dist_long_within_sampleid_from_control$method_2, path_horn_dist_long_within_sampleid_from_control$treatment) "
"0",""
"0",""
"0","#Setting key method"
"0","path_horn_dist_long_within_sampleid_from_control$sample_type <- ifelse(grepl(""NS"", path_horn_dist_long_within_sampleid_from_control$iso1), ""Nasal"","
"0","                                                                  ifelse(grepl(""CFB"", path_horn_dist_long_within_sampleid_from_control$iso1), ""Sputum"","
"0","                                                                         ifelse(grepl(""BAL"", path_horn_dist_long_within_sampleid_from_control$iso1), ""BAL"","
"0","                                                                                ifelse(grepl(""pos|POS"", path_horn_dist_long_within_sampleid_from_control$iso1, ignore.case = T), ""Mock"","
"0","                                                                                       ifelse(grepl(""neg|N_EXT"", path_horn_dist_long_within_sampleid_from_control$iso1), ""Neg."",NA)))))"
"0",""
"0","#Making a column for baseline (controls, from where?)"
"0","path_horn_dist_long_within_sampleid_from_control <- path_horn_dist_long_within_sampleid_from_control %>% "
"0","        mutate(dist_from = case_when(method_1 == ""control"" ~ iso1,"
"0","                                     method_2 == ""control"" ~ iso2))"
"0",""
"0","dummy <- data.frame(iso1 = path_horn_dist_long_within_sampleid_from_control$dist_from %>% unique,"
"0","           iso2 = path_horn_dist_long_within_sampleid_from_control$dist_from %>% unique,"
"0","           dist = 0,"
"0","           treatment = ""Untreated"","
"0","           method_1 = ""control"","
"0","           method_2 = ""control"""
"0","           )"
"0","names <- data.frame(str_split_fixed(dummy$iso1, ""_"", 3))"
"0","names2 <- data.frame(str_split_fixed(dummy$iso2, ""_"", 3))"
"0","dummy$sample_id_1 <- paste(names$X1, names$X2, sep = ""_"")"
"0","#Adding data for iso 2 also should be done"
"0","dummy$sample_id_2 <- paste(names2$X1, names2$X2, sep = ""_"")"
"0",""
"0",""
"0","#subsetting distances of my interest"
"0","dummy$sample_id_1 <- ifelse(grepl(""pos"", dummy$sample_id_1, ignore.case = T),""Mock"", "
"0","                                 ifelse(grepl(""neg|n_"", dummy$sample_id_1, ignore.case = T),""Neg."","
"0","                                        dummy$sample_id_1))"
"0","dummy$sample_id_2 <- ifelse(grepl(""pos"", dummy$sample_id_2, ignore.case = T),""Mock"", "
"0","                                 ifelse(grepl(""neg|n_"", dummy$sample_id_2, ignore.case = T),""Neg."","
"0","                                        dummy$sample_id_2))"
"0","dummy$sample_type <- ifelse(grepl(""NS"", dummy$iso1), ""Nasal"","
"0","                            ifelse(grepl(""CFB"", dummy$iso1), ""Sputum"","
"0","                                   ifelse(grepl(""BAL"", dummy$iso1), ""BAL"","
"0","                                          ifelse(grepl(""pos|POS"", dummy$iso1, ignore.case = T), ""Mock"","
"0","                                                 ifelse(grepl(""neg|N_EXT"", dummy$iso1), ""Neg."",NA)))))"
"0","dummy <- subset(dummy, !is.na(dummy$sample_type))"
"0","path_horn_dist_long_within_sampleid_from_control <- bind_rows(path_horn_dist_long_within_sampleid_from_control, dummy)"
"0",""
"0",""
"0","path_horn_dist_long_within_sampleid_from_control$subject_id <- path_horn_dist_long_within_sampleid_from_control$sample_id_1"
"0",""
"0","path_horn_dist_long_within_sampleid_from_control$treatment <-"
"0","        factor(path_horn_dist_long_within_sampleid_from_control$treatment,"
"0","               levels = c(""Untreated"", ""lypma"", ""benzonase"", ""host_zero"", ""molysis"", ""qiaamp""))"
"0",""
"0",""
"0","f4b2 <- f3b2 <- rbind(cbind(""Sputum"","
"0","            lmer(dist ~ treatment + (1|subject_id),"
"0","                data = path_horn_dist_long_within_sampleid_from_control %>%"
"0","                        subset(sample_type == ""Sputum"")) %>% "
"0","                    confint()"
"0","            ),"
"0","      cbind(""BAL"","
"0","            lmer(dist ~ treatment + (1|subject_id),"
"0","                 data = path_horn_dist_long_within_sampleid_from_control %>%"
"0","                         subset(sample_type == ""BAL"")) %>% "
"0","                    confint()"
"0","            ),"
"0","      cbind(""Nasal"","
"0","            lmer(dist ~ treatment + (1|subject_id),"
"0","                 data = path_horn_dist_long_within_sampleid_from_control %>%"
"0","                         subset(sample_type == ""Nasal"")) %>% "
"0","                    confint()"
"0","     )"
"0",") %>% {"
"0","        row_names <- rownames(.)"
"0","        data_frame <- data.frame(.)"
"0","        data_frame$treatment <- row_names"
"0","        data_frame %>% "
"0","                remove_rownames() %>%"
"0","                rename(sample_type = ""V1"","
"0","               ""2.5%"" = ""X2.5.."","
"0","               ""97.5%"" = ""X97.5.."") %>% "
"0","                mutate(`2.5%` = as.numeric(`2.5%`),"
"0","                       `97.5%` = as.numeric(`97.5%`),"
"0","                       mean = (`97.5%`+`2.5%`)/2,"
"0","                       treatment = case_when(treatment == ""(Intercept)"" ~ ""Untreated"","
"0","                                             treatment == ""treatmentlypma"" ~ ""lyPMA"","
"0","                                             treatment == ""treatmentbenzonase"" ~ ""Benzonase"","
"0","                                             treatment == ""treatmenthost_zero"" ~ ""HostZERO"","
"0","                                             treatment == ""treatmentmolysis"" ~ ""MolYsis"","
"0","                                             treatment == ""treatmentqiaamp"" ~ ""QIAamp"""
"0","                                             ),"
"0","                       treatment = factor(treatment,"
"0","                                          levels = c(""Untreated"", ""lyPMA"", ""Benzonase"","
"0","                                      ""HostZERO"", ""MolYsis"", ""QIAamp"")),"
"0","                       sample_type = factor(sample_type,"
"0","                                          levels = c(""BAL"", ""Nasal"", ""Sputum""))"
"0","                       ) %>%"
"0","                subset(treatment %in% c(#""Untreated"", "
"0","                                        ""lyPMA"", ""Benzonase"","
"0","                                      ""HostZERO"", ""MolYsis"", ""QIAamp""))"
"0","} %>%"
"0","        ggplot(aes(x = mean, y = treatment, col = treatment)) +"
"0","        geom_point(aes(x=mean), shape=15, size=3) +"
"0","        geom_linerange(aes(xmin=`2.5%`, xmax=`97.5%`)) +"
"0","        facet_wrap(~sample_type, nrow = 4) +"
"0","        scale_y_discrete(limits=rev) +"
"0","        scale_color_manual(values = c(#""#e31a1c"","
"0","                                      ""#fb9a99"",""#33a02c"","
"0","                                      ""#b2df8a"",""#1f78b4"",""#a6cee3""),"
"0","                           name = ""Treatment"","
"0","                           breaks = c(#""Untreated"", "
"0","                                      ""lyPMA"", ""Benzonase"","
"0","                                      ""HostZERO"", ""MolYsis"", ""QIAamp"")) + #color using https://colorbrewer2.org/#type=qualitative&scheme=Set1&n=6"
"0","        xlab(""Morisita-Horn index from untreated"") +"
"0","        ylab(""Treatment group"") +"
"0","        theme_classic (base_size = 12, base_family = ""sans"") + "
"0","        theme(plot.tag = element_text(size = 15),"
"0","              axis.text.y = element_blank(),"
"0","              axis.ticks.y = element_blank(),"
"0","              legend.position = ""none"") +"
"0","        labs(tag = ""B"") +"
"0","        geom_vline(xintercept = 0, col = ""black"", linetype=""dotted"") +"
"0","        #coord_cartesian(xlim=c(-0.5, 1)) +"
"0","        #geom_text(aes(x = 0, label = treatment), hjust = 0, nudge_x = -.55, size = 3, color = ""black"", family = ""sans"") +"
"0","        #geom_text(aes(x = 0, label = text), hjust = 0, nudge_x = -0.4, size = 3, color = ""black"", family = ""sans"") +"
"0","        scale_x_continuous(breaks = c(-0.25, 0, 0.25, 0.5, 0.75),"
"0","                           labels = c(-0.25, ""0 (low bias)"", 0.25, 0.5, ""0.75 (high bias)""))"
"0",""
"0",""
"0",""
"0",""
"0","figS8 <- ggarrange(f4a, f4b2, ncol = 1, common.legend = T, align = ""hv"") +"
"0","        guides(fill = guide_legend(nrow = 1))"
"0",""
"0",""
"0","figS8"
