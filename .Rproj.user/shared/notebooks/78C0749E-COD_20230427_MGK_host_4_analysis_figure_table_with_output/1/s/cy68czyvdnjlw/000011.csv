"0",""
"0","#Making significance table for figure"
"0","        # Define a function to make species names italicized"
"0","# Make a significance table for each figure (top 20 taxa)"
"0","make_sig_table <- function(data) {"
"0","  sig_data <- spread(data[order(data$qval), c(""feature"", ""metadata"", ""qval"")], metadata, qval)"
"0","  sig_data$feature <- gsub(""[.]"", ""-"", sig_data$feature)"
"0","  sig_data$min <- apply(sig_data %>% dplyr::select(c(""lypma"", ""benzonase"", ""molysis"", ""host_zero"", ""qiaamp"")), 1, FUN = min)"
"0","  sig_data <- sig_data[order(sig_data$min),] %>% dplyr::select(""feature"", ""lypma"", ""benzonase"", ""host_zero"", ""molysis"", ""qiaamp"") %>% .[1:20,]"
"0","  sig_data[[""feature""]] <- ifelse(sig_data[[""feature""]] == ""X.Collinsella._massiliensis"", ""[Collinsella]_massiliensis"", sig_data[[""feature""]])"
"0","  sig_data_italic <- sig_data %>% rownames_to_column(var = ""-"") %>%"
"0","          column_to_rownames(var = ""feature"") %>% dplyr::select(-c(""-"")) %>%"
"0","          rename(lyPMA = lypma,  Benzonase = benzonase, `HostZERO` = host_zero, MolYsis = molysis, QIAamp = qiaamp)"
"0","  sig_data_sig <- ifelse(sig_data_italic < 0.1, ""*"", NA) %>% data.frame(check.names = F)"
"0","  return(list(data = sig_data, data_italic = sig_data_italic, data_sig = sig_data_sig))"
"0","}"
"0",""
"0","#f_fit_data_pos <- make_sig_table(f_fit_data_pos)"
"0","f_fit_data_bal <- make_sig_table(f_fit_data_bal)"
"0","f_fit_data_ns <- make_sig_table(f_fit_data_ns)"
"0","f_fit_data_spt <- make_sig_table(f_fit_data_spt)"
"0",""
"0","#f_pos_sig <- subset_taxa(subset_samples(phyloseq_rel_nz, sample_type == ""Mock""),"
"0","#                                       taxa_names(subset_samples(phyloseq_rel_nz, sample_type == ""Mock"")) %in% f_fit_data_pos$data$feature)"
"0","#f_fit_data_pos$rel <- cbind(f_pos_sig %>% otu_table %>% t, f_pos_sig %>% sample_data) %>% group_by(treatment) %>% summarise_if(is.numeric, mean, na.rm = TRUE) %>% .[, 1:21] %>% column_to_rownames(., ""treatment"") %>% t () %>% data.frame(check.names = F) %>% "
"0","#        .[row.names(f_fit_data_pos$data_italic),] %>%  mutate_all(~na_if(., 0)) %>% rownames_to_column(""feature"")"
"0",""
"0",""
"0","f_spt_sig <- subset_taxa(subset_samples(phyloseq_rel_nz, sample_type == ""Sputum""),"
"0","                                       taxa_names(subset_samples(phyloseq_rel_nz, sample_type == ""Sputum"")) %in% f_fit_data_spt$data$feature)"
"0",""
"0",""
"0","f_fit_data_spt$rel <- cbind(f_spt_sig %>% otu_table %>% t, f_spt_sig %>% sample_data) %>% group_by(treatment) %>% summarise_if(is.numeric, mean, na.rm = TRUE) %>% .[, 1:21] %>% column_to_rownames(., ""treatment"") %>% t () %>% data.frame(check.names = F) %>% "
"0","        .[row.names(f_fit_data_spt$data_italic),] %>%  mutate_all(~na_if(., 0)) %>% rownames_to_column(""feature"")"
"0",""
"0","f_ns_sig <- subset_taxa(subset_samples(phyloseq_rel_nz, sample_type == ""Nasal""),"
"0","                                       taxa_names(subset_samples(phyloseq_rel_nz, sample_type == ""Nasal"")) %in% f_fit_data_ns$data$feature)"
"0",""
"0","f_fit_data_ns$rel <- cbind(f_ns_sig %>% otu_table %>% t, f_ns_sig %>% sample_data) %>% group_by(treatment) %>% summarise_if(is.numeric, mean, na.rm = TRUE) %>% .[, 1:21] %>% column_to_rownames(., ""treatment"") %>% t () %>% data.frame(check.names = F) %>% "
"0","        .[row.names(f_fit_data_ns$data_italic),] %>%  mutate_all(~na_if(., 0)) %>% rownames_to_column(""feature"")"
"0","f_fit_data_ns$rel$feature <- row.names(f_fit_data_ns$data_sig)"
"0",""
"0","f_bal_sig <- subset_taxa(subset_samples(phyloseq_rel_nz, sample_type == ""BAL""),"
"0","                                       taxa_names(subset_samples(phyloseq_rel_nz, sample_type == ""BAL"")) %in% f_fit_data_bal$data$feature)"
"0",""
"0","f_fit_data_bal$rel <- cbind(f_bal_sig %>% otu_table %>% t, f_bal_sig %>% sample_data) %>% group_by(treatment) %>% summarise_if(is.numeric, mean, na.rm = TRUE) %>% .[, 1:21] %>% column_to_rownames(., ""treatment"") %>% t () %>% data.frame(check.names = F) %>%"
"0","        .[row.names(f_fit_data_bal$data_italic),] %>%"
"0","        mutate_all(~na_if(., 0)) %>% rownames_to_column(""feature"")"
"0",""
"0",""
"0",""
